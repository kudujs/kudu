!function(e,t,r){t[e]=t[e]||r(),"undefined"!=typeof module&&module.exports?module.exports=t[e]:"function"==typeof define&&define.amd&&define("utils/jqr/npo",[],function(){return t[e]})}("Promise","undefined"!=typeof global?global:this,function(){"use strict";function e(e,t){v.add(e,t),f||(f=h(v.drain))}function t(e){var t,r=typeof e;return null==e||"object"!=r&&"function"!=r||(t=e.then),"function"==typeof t?t:!1}function r(){for(var e=0;e<this.chain.length;e++)n(this,1===this.state?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function n(e,r,n){var i,o;try{r===!1?n.reject(e.msg):(i=r===!0?e.msg:r.call(void 0,e.msg),i===n.promise?n.reject(TypeError("Promise-chain cycle")):(o=t(i))?o.call(i,n.resolve,n.reject):n.resolve(i))}catch(u){n.reject(u)}}function i(n){var u,s=this;if(!s.triggered){s.triggered=!0,s.def&&(s=s.def);try{(u=t(n))?e(function(){var e=new a(s);try{u.call(n,function(){i.apply(e,arguments)},function(){o.apply(e,arguments)})}catch(t){o.call(e,t)}}):(s.msg=n,s.state=1,s.chain.length>0&&e(r,s))}catch(c){o.call(new a(s),c)}}}function o(t){var n=this;n.triggered||(n.triggered=!0,n.def&&(n=n.def),n.msg=t,n.state=2,n.chain.length>0&&e(r,n))}function u(e,t,r,n){for(var i=0;i<t.length;i++)!function(i){e.resolve(t[i]).then(function(e){r(i,e)},n)}(i)}function a(e){this.def=e,this.triggered=!1}function s(e){this.promise=e,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function c(t){if("function"!=typeof t)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var n=new s(this);this.then=function(t,i){var o={success:"function"==typeof t?t:!0,failure:"function"==typeof i?i:!1};return o.promise=new this.constructor(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");o.resolve=e,o.reject=t}),n.chain.push(o),0!==n.state&&e(r,n),o.promise},this["catch"]=function(e){return this.then(void 0,e)};try{t.call(void 0,function(e){i.call(n,e)},function(e){o.call(n,e)})}catch(u){o.call(n,u)}}var l,f,v,d=Object.prototype.toString,h="undefined"!=typeof setImmediate?function(e){return setImmediate(e)}:setTimeout;try{Object.defineProperty({},"x",{}),l=function(e,t,r,n){return Object.defineProperty(e,t,{value:r,writable:!0,configurable:n!==!1})}}catch(p){l=function(e,t,r){return e[t]=r,e}}v=function(){function e(e,t){this.fn=e,this.self=t,this.next=void 0}var t,r,n;return{add:function(i,o){n=new e(i,o),r?r.next=n:t=n,r=n,n=void 0},drain:function(){var e=t;for(t=r=f=void 0;e;)e.fn.call(e.self),e=e.next}}}();var m=l({},"constructor",c,!1);return c.prototype=m,l(m,"__NPO__",0,!1),l(c,"resolve",function(e){var t=this;return e&&"object"==typeof e&&1===e.__NPO__?e:new t(function(t,r){if("function"!=typeof t||"function"!=typeof r)throw TypeError("Not a function");t(e)})}),l(c,"reject",function(e){return new this(function(t,r){if("function"!=typeof t||"function"!=typeof r)throw TypeError("Not a function");r(e)})}),l(c,"all",function(e){var t=this;return"[object Array]"!=d.call(e)?t.reject(TypeError("Not an array")):0===e.length?t.resolve([]):new t(function(r,n){if("function"!=typeof r||"function"!=typeof n)throw TypeError("Not a function");var i=e.length,o=Array(i),a=0;u(t,e,function(e,t){o[e]=t,++a===i&&r(o)},n)})}),l(c,"race",function(e){var t=this;return"[object Array]"!=d.call(e)?t.reject(TypeError("Not an array")):new t(function(r,n){if("function"!=typeof r||"function"!=typeof n)throw TypeError("Not a function");u(t,e,function(e,t){r(t)},n)})}),c}),define("utils/utils",["require","./jqr/npo"],function(e){function t(e){var t={},r=new Promise(function(e,t){e()});return t.noopPromise=function(){return r},t.isPromise=function(e){return null==e?!1:"function"==typeof e.then?!0:!1},t.isRactiveObject=function(e){return"object"==typeof e&&null!==e&&null!=e._guid?!0:!1},t.objectLength=function(e){if(Object.keys)return Object.keys(e).length;var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++},t}e("./jqr/npo");var t=t();return t}),define("utils/jqr/jqutils",["require","./npo"],function(e){function t(e){function t(e){return Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/,"$1").toLowerCase()}function r(e,n,o,u){var a;if(Array.isArray(n))n.forEach(function(t,n){o||i.test(e)?u(e,t):r(e+"["+("object"==typeof t?n:"")+"]",t,o,u)});else if(o||"object"!==t(n))u(e,n);else for(a in n)r(e+"["+a+"]",n[a],o,u)}var n={},i=/\[\]$/,o=/%20/g;return n.isFunction=function(e){return"function"==typeof e},n.fadeIn=function(e){e.style.opacity=0;var t=+new Date,r=function(){e.style.opacity=+e.style.opacity+(new Date-t)/400,t=+new Date,+e.style.opacity<1&&(window.requestAnimationFrame&&requestAnimationFrame(r)||setTimeout(r,16))};r()},n.fadeOut=function(e){e.style.opacity=0;var t=+new Date,r=function(){e.style.opacity=+e.style.opacity+(new Date-t)/400,t=+new Date,+e.style.opacity<1&&(window.requestAnimationFrame&&requestAnimationFrame(r)||setTimeout(r,16))};r()},n.extend=function(e){e=e||{};for(var t=1;t<arguments.length;t++)if(arguments[t])for(var r in arguments[t])arguments[t].hasOwnProperty(r)&&(e[r]=arguments[t][r]);return e},n.param=function(e,t){var n,i=[],u=function(e,t){t="function"==typeof t?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(Array.isArray(e))e.forEach(function(e,t){u(e.name,e.value)});else for(n in e)r(n,e[n],t,u);return i.join("&").replace(o,"+")},n}e("./npo");var t=t();return t}),define("router/router",["require","../utils/jqr/npo","../utils/utils","../utils/jqr/jqutils"],function(e){"use strict";function t(){var t=new Promise(function(r,i){var o=window.location.href.indexOf("#");if(-1===o||o===location.href.length-1){if(null==a)throw new Error("Couldn't resolve the url, "+location.href+", to a route. Please set the option 'kudu.defaultRoute' to render a default page!");return r(a),t}var u=q.urlPath(window.location.href);u=n(u),e([u],function(e){if(null==e)return void i();var t={path:u,ctrl:e,moduleId:u};r(t)},function(){i()})});return t}function r(e,t){if(null!=t){var r=!0,n=f.param(t,r);n.length>0&&(e=-1===e.indexOf("?")?e+"?"+n:e+"&"+n)}return e}function n(e){return"string"==typeof e&&0===e.indexOf("/")?e.slice(1):e}function i(e){c!=e&&(g=!0)}function o(e,t){return e.length>0&&"/"!==e&&(e+="/"),0==t.length&&(t="/"),e+=t}e("../utils/jqr/npo");var u,a,s,c,l=e("../utils/utils"),f=e("../utils/jqr/jqutils"),v={},d={},h={},p={statechange:[],routeload:[]},m=[],w={},g=!1,y="",P=function(){if(y!=window.location.href){if(y=window.location.href,q.getHash()===c)return;c=q.getHash(),q.fire("statechange")}},q={init:function(e){return c=q.getHash(),"undefined"==typeof e&&(e={}),q.addRoutes(e.routes),u=e.unknownRouteResolver||t,a=e.defaultRoute||null,window.addEventListener?(window.addEventListener("popstate",P,!1),window.addEventListener("hashchange",P,!1)):(window.attachEvent("popstate",P),window.attachEvent("onhashchange",P)),e.loadCurrentRouteOnStateChange!==!1&&q.on("statechange",function(){if(g)return void(g=!1);var e={};q.loadCurrentRoute(e)}),e.fireInitialStateChange!==!1&&q.fire("statechange"),q},activeRoute:{},addRoutes:function(e){for(var t in e)e.hasOwnProperty(t)&&q.addRoute(e[t]);return q},addRoute:function(e){if(m.push(e),null==e.moduleId){if(null==e.ctrl)throw new Error("route must have a ctrl or moduleId defined!");e.moduleId=e.ctrl.id}return q.addRouteById(e),q},addRouteAt:function(e,t){return m.splice(e,0,t),q.addRouteById(t),q},addRouteById:function(e){"*"===e.path&&(s=e),void 0===w[e.moduleId]&&(w[e.moduleId]=[]),w[e.moduleId].push(e.path)},getRoutes:function(){return m},getRoutesById:function(){return w},on:function(e,t){return"undefined"==typeof p[e]&&(p[e]=[]),p[e].push(t),q},fire:function(e){if(p[e])for(var t=Array.prototype.slice.call(arguments,1),r=0;r<p[e].length;r++)p[e][r].apply(q,t);return q},off:function(e,t){if(p[e]){var r=p[e].indexOf(t);-1!==r&&p[e].splice(r,1)}return q},go:function(e){var t,n=e.ctrl;if(null==n&&e.route&&(n=e.route.ctrl,t=e.route.moduleId),null==n)throw new Error("router.go() requires a 'ctrl' passed as an option !");if(null==t&&(t=n.id),e.args=e.args||{},e.routeParams=e.routeParams||{},e.updateUrl===!1){var u={};u.moduleId=t,u.ctrl=n,e.route=u;var a=q.hashPath(c);return a=r(a,e.routeParams),i(a),q.setHash(a),void q.loadModule(e)}for(var l=null,f=q.findRoutesForCtrl(n),v=0;v<f.length;v++){var d=f[v],h=q.testCtrlRoute(d.path,e.routeParams);if(h){l=d;break}}if(null==l){console.error("No route matched request to Controller '"+n.id+"'! Available routes for this controller: ");for(var v=0;v<f.length;v++){var p=f[v];console.error("    ",p.path)}if(console.error("RouteParams used to match available Controller routes:",e.routeParams),!e.force)return e.route=s,null==e.route&&(e.route={}),void q.loadModule(e);console.error("options.force is true: will attempt to load the controller from moduleId: '"+t+"'")}var m=null!=l?l.path:t;if(m instanceof RegExp)throw new Error("Cannot route to controller '"+n.id+"' since it's route path is a RegExp '"+m+"'");if(-1!==m.indexOf("*"))throw new Error("Cannot route to controller '"+n.id+"' since it's route path contains wildcards '*'. The given route for the controller is '"+m+"'");var w={};if(-1!==m.indexOf("?")){var g=q.queryString(m);g.length>0&&(w=q.parseRouteQueryParams(g)),m=m.substr(0,m.indexOf("?"))}var y="",P=e.routeParams,x=m.split("/");for(var j in x)if(x.hasOwnProperty(j)){var b=x[j];if(":"===b.charAt(0)){var R=b.substr(1),E=P[R];if(null==E||""===E)throw new Error("Cannot route to controller '"+n.id+"' since it's route requires the path parameter '"+R+"' but the only params provided are '"+JSON.stringify(P)+"'");y=o(y,E),delete P[R]}else y=o(y,b)}for(var O in w)if(w.hasOwnProperty(O)){if(null==P)throw new Error("Cannot route to controller '"+n.id+"' since it's route requires the query parameter '"+O+"' but no routeParams was provided");var E=P[O];if(void 0===E)throw new Error("Cannot route to controller '"+n.id+"' since it's route requires the query parameter '"+O+"' but the only routeParams provided are '"+JSON.stringify(P)+"'")}y=r(y,P),i(y),q.setHash(y),q.loadCurrentRoute(e)},setHash:function(e){window.location.hash=e},getHash:function(){var e=window.location.href.indexOf("#"),t=-1==e?"":window.location.href.substr(e+1);return 0==t.indexOf("!")&&(t=t.substr(1)),t},findRoutesForCtrl:function(e){for(var t=[],r=e.id,n=0;n<m.length;n++){var i=m[n];null==r||null==i.moduleId?e===i.ctrl&&t.push(i):r===i.moduleId&&t.push(i)}return t},testCtrlRoute:function(e,t){e=n(e);var r=q.parseRouteParams(e);for(var i in r)if(r.hasOwnProperty(i)){if(!t.hasOwnProperty(i))return!1;var o=r[i];if(o.segment===!0){var u=t[i];if(null==u||""==u)return!1}}return!0},loadCurrentRoute:function(e){e=e||{};for(var t=null,r=0;r<m.length;r++){var n=m[r];if(e.route=n,q.testRoute(e)){t=n;break}}return null==t||"*"===t.path?(e.route=t,q.handleUnknownRoute(e),q):(null!=t&&(e.route=t,q.loadModule(e)),q)},handleUnknownRoute:function(e){var t=u(e.route);return l.isPromise(t)?t.then(function(t){e.route=t,q.loadUnknownRoute(e)})["catch"](function(){null!=e.route&&q.loadModule(e)}):(e.route=t,q.loadUnknownRoute(e)),q},loadUnknownRoute:function(e){if(e=e||{},null!=e.route){if(null==e.route.moduleId||null==e.route.path)throw new Error("unknownRouteResolver must return a route object with a valid moduleId and path or a promise that resolves to a route object!");var t=q.getRoutesById()[e.route.moduleId];null==t?(e.route.isNew=!0,q.loadModule(e)):q.go(e)}return q},loadModule:function(t){t=t||{};var r=t.route;null==r.ctrl?e([r.moduleId],function(e){null!=e&&q.processLoadedModule(t,e,r)},function(){}):q.processLoadedModule(t,r.ctrl,r)},urlPath:function(e){if("undefined"!=typeof v[e])return v[e];var t=e.split("/"),r="/"+t.splice(3,t.length-3).join("/"),n=r.split(/[\?#]/)[0],i=r.indexOf("#"),o=i===r.length-1;if(-1!==i&&!o){var u=r.substring(i).split("?")[0];n="#!"===u.substring(0,2)?u.substring(2):u.substring(1)}return v[e]=n,n},processLoadedModule:function(e,t,r){if(q.activeRoute.active=!1,r.active=!0,q.activeRoute=r,r.isNew&&(delete r.isNew,q.addRouteAt(0,r)),r.active){var n=e.urlParams;null==n&&(n=q.routeArguments(r,window.location.href),e.urlParams=n);var i=f.extend({},e);i.routeParams=n,i.module=t,i.route=r,q.fire("routeload",i)}},testRoute:function(e){var t=q.urlPath(e.url||window.location.href);t=n(t);var r=e.route.path;if(r=n(r),r===t)return!0;if("*"===r)return!0;if(r instanceof RegExp)return r.test(t);if(-1===r.indexOf("*")&&-1===r.indexOf(":")&&-1===r.indexOf("?"))return!1;var i=t.split("/"),o=r.indexOf("?");-1!==o&&o!==r.length-1&&(r=r.substr(0,o));var u=r.split("/");if(i.length!==u.length)return!1;for(var a in u)if(u.hasOwnProperty(a)){var s=u[a],c=i[a];if("*"===s||":"===s.charAt(0)){if(null==c||""===c)return!1}else if(s!==c)return!1}if(-1!==o){var l=e.route.path;l=n(l);var f=l.substr(o+1),v=q.parseRouteQueryParams(f);if(null==e.urlParams){var d=q.routeArguments(e.route,window.location.href);e.urlParams=d}for(var a in v)if(v.hasOwnProperty(a)){var h=e.urlParams[a];if(null==h)return!1}}return!0},routeArguments:function(e,t){e||(e=q.activeRoute),t||(t=window.location.href);var r={},i=q.urlPath(t);i=n(i);var o=i.split("/"),u=[];if(e&&e.path&&!(e.path instanceof RegExp)){var a=e.path;a=n(a),u=a.split("/")}for(var s in u)if(u.hasOwnProperty(s)){var c=u[s];if(":"===c.charAt(0)){c=c.substring(1);var l=c.indexOf("?");-1!==l&&(c=c.substr(0,l)),r[c]=o[s]}}var f=q.queryString(t),v=q.queryParamsFromSearchString(f);for(var d in v)v.hasOwnProperty(d)&&(r[d]=v[d]);return r=q.parseArguments(r)},queryString:function(e){var t=e.indexOf("?"),r="";if(-1!==t){r=e.substring(t+1);var n=r.indexOf("#");-1!==n&&(r=r.substring(0,n))}var i=e.indexOf("#"),o=e.indexOf("#!");if(-1!==i||-1!==o){var u="";u=-1!==i?e.substring(i):e.substring(o),t=u.indexOf("?"),-1!==t&&(r=u.substring(t+1))}return r},queryParams:function(e){var t=q.queryString(e),r=q.queryParamsFromSearchString(t);return r},queryParamsFromSearchString:function(e){var t={},r=e.split("&");1===r.length&&""===r[0]&&(r=[]);for(var n in r)if(r.hasOwnProperty(n)){var i=r[n],o=i.split("="),u=o.splice(1,o.length-1).join("=");t[o[0]]=u}return t},parseArguments:function(e){for(var t in e){var r=e[t];"true"===r?e[t]=!0:"false"===r?e[t]=!1:isNaN(r)||""===r||"0"===r.charAt(0)?e[t]=decodeURIComponent(r):e[t]=+r}return e},parseRouteQueryParams:function(e){var t=h[e];if(null!=t)return t;var r={},n=e.split("&");1===n.length&&""===n[0]&&(n=[]);for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];r[o]={query:!0}}return h[e]=r,r},parseRouteParams:function(e){var t=d[e];if(null!=t)return t;var r=e,n={};if(null==r||""==r)return n;if(r instanceof RegExp&&(r=r.toString(),r=r.substring(1,r.length-1)),-1===r.indexOf(":")&&-1!==r.indexOf("?"))return d[e]=n,n;var i=r.indexOf("?");-1!==i&&i!==r.length-1&&(r=r.substr(0,i));var o=r.split("/");for(var u in o)if(o.hasOwnProperty(u)){var a=o[u];if(":"===a.charAt(0)){var s=a.slice(1);n[s]={segment:!0}}}if(-1!==i){var c=e.substr(i+1),l=q.parseRouteQueryParams(c);n=f.extend(n,l)}return d[e]=n,n},hashPath:function(e){0===e.indexOf("#")&&(e=e.substring(1));var t=e.indexOf("?");return t>=0&&(e=e.substring(0,t)),e}};return q}),define("utils/ajaxTracker",["require","./jqr/npo"],function(e){function t(e){var t=new Promise(function(t,r){e.then(function(e,r,n){t({data:e,status:r,xhr:n})},function(e,t,n){r({error:n,status:t,xhr:e})}),e.then(t,r)});return t.abort=e.abort,t}function r(e){function r(e){var t=e.slice();t.forEach(function(e,t){e.promise.abort()}),c=null}function n(t,r,n,u){function a(r,a){var s;if(i(r.xhr)){var c;arguments.length>0&&(c=Array.prototype.slice.call(arguments)),s={data:null,status:null,xhr:null,error:null,args:u,promiseArgs:c}}else s=a===!0?{data:r.data,status:r.status,xhr:r.xhr,error:null,args:u}:{data:null,status:r.status,xhr:r.xhr,error:r.error,args:u};e.emit("ajax.complete",s);o.remove(t,n)}n.then(function(t){var r;if(i(t.xhr))r={data:t.data,status:t.status,xhr:t.xhr,args:u};else{var n;arguments.length>0&&(n=Array.prototype.slice.call(arguments)),r={data:null,status:null,xhr:null,error:null,args:u,promiseArgs:n}}e.emit("ajax.success",r)})["catch"](function(t){var r;if(i(t.xhr))r={error:t.error,status:t.status,xhr:t.xhr,args:u};else{var n;arguments.length>0&&(n=Array.prototype.slice.call(arguments)),r={data:null,status:null,xhr:null,error:null,args:u,promiseArgs:n}}e.emit("ajax.error",r)}),n.then(function(e){a(e,!0)})["catch"](function(e){a(e,!1)}),r.then(function(t){var n;if(i(t.xhr))n={data:t.data,status:t.status,xhr:t.xhr,args:u};else{var o;arguments.length>0&&(o=Array.prototype.slice.call(arguments)),n={data:null,status:null,xhr:null,error:null,args:u,promiseArgs:o}}null==c||c==r?(e.emit("ajax.stop",n),delete n.args,e.emit("global.ajax.stop",n),c=null):e.emit("ajax.stop",n)})["catch"](function(t){var n;if(i(t.xhr))n={error:t.error,status:t.status,xhr:t.xhr,args:u};else{var o;arguments.length>0&&(o=Array.prototype.slice.call(arguments)),n={data:null,status:null,xhr:null,error:null,args:u,promiseArgs:o}}return null!=c&&c!=r?void e.emit("ajax.stop",n):(e.emit("ajax.stop",n),delete n.args,e.emit("global.ajax.stop",n),c=null,void 0)})}function i(e){return null!=e&&"function"==typeof e.getAllResponseHeaders&&"function"==typeof e.abort?!0:!1}if(null==e)throw new Error("ajaxTracker requires a kudu instance!");var o={},u=0,a=0,s={},c=null;return o.add=function(r,o,l){if("function"!=typeof o.abort)throw new Error("ajaxTracker.add(promise) requires an 'abort' function for when views are cancelled!");i(o)&&"function"==typeof o.then&&(o=t(o));var f=s[r];null==f&&(f=[],s[r]=f);var v={promise:o,args:l};f.push(v);var d={xhr:o,args:l};return null==c?(c=Promise.all([o]),e.emit("global.ajax.start",d),d.args=l,e.emit("ajax.start",d)):(c=Promise.all([c,o]),d.args=l,e.emit("ajax.start",d)),c._id=u++,n(r,c,o,l),a++,c},o.remove=function(e,t){var r=s[e];if(null==r)return!1;for(var n=-1,i=0;i<r.length;i++){var o=r[i];if(o.promise===t){n=i;break}}return n>=0?(r.splice(n,1),0===r.length&&delete s[e],a--,!0):!1},o.clear=function(e){0===arguments.length?s={}:delete s[e]},o.abort=function(e){if(0===arguments.length){for(var t in s)if(s.hasOwnProperty(t)){var n=s[t];r(n)}return void r(n)}var n=s[e];null!=n&&r(n)},o}return e("./jqr/npo"),r}),define("utils/simpleAjaxTracker",["require"],function(e){var t={};return t.create=function(e,t){var r={add:function(r,n){e.add(t.target,r,n)},remove:function(r){e.remove(t.target,r)},abort:function(){e.abort(t.target)}};return r},t}),define("lifecycle/onInitHandler",["require","../utils/jqr/npo"],function(e){function t(e){var t=new Promise(function(r,n){if("function"!=typeof e.ctrl.onInit)return n("Controllers *must* implement an onInit method that returns either a Ractive function or a promise that resolves to a Ractive function!"),t;var i={ctrl:e.ctrl,route:e.route,routeParams:e.routeParams,args:e.args,ajaxTracker:e.ajaxTracker,prev:e.prev},o=e.ctrl.onInit(i);r(o)});return t}return e("../utils/jqr/npo"),t}),define("lifecycle/onRemoveHandler",["require","../utils/utils","../utils/jqr/npo"],function(e){function t(e){var t=new Promise(function(n,i){if("function"!=typeof e.ctrl.onRemove)return n(),t;var o={ctrl:e.ctrl,route:e.route,routeParams:e.routeParams,args:e.args,view:e.view,ajaxTracker:e.ajaxTracker,next:e.next},u=e.ctrl.onRemove(o);return null==u||1==u?(n(),t):0==u?(i("controller onRemove() returned false"),t):void(r.isPromise(u)?u.then(function(r){return e.mvc.requestTracker.active?void(null==r||1==r?n():i()):(i("Request overwritten by another view request"),t)})["catch"](function(){i()}):(console.warn("Ignoring new view since onRemove did not return a valid response. onRemove must return either true/false or a promise that resolves to true/false."),i()))});return t}var r=e("../utils/utils");return e("../utils/jqr/npo"),t}),define("ractivelib/setupEvents",["require"],function(e){function t(e){if(e.view.off){e.view.off("complete"),e.view.off("render"),e.view.off("unrender"),e.view.off("teardown"),e.view.on("complete",function(){this.transitionsEnabled=!0}),e.view.on("render",function(){}),e.view.on("unrender",function(){}),e.view.on("teardown",function(){});var t={};return t}}return t}),define("ractivelib/setupDefaultEvents",["require","ractive"],function(e){function t(e){r.defaults.onconstruct=function(){};var t={};return t}var r=e("ractive");return t}),define("utils/jqr/fade",["require"],function(e){function t(){function e(e){return"number"!=typeof e&&(e=e in r?r[e]:r["default"]),e}var t={},r={slow:600,fast:200,"default":400},n=!1,i=[],o={fadeIn:!1,el:null,cb:null,requestId:null,timeoutId:null};return t.off=function(e){n=e},t.stop=function(){i.forEach(function(e,t){e.fadeIn?e.el.style.opacity=1:e.el.style.opacity=0,null!=e.timeoutId&&clearTimeout(e.timeoutId),null!=e.requestId&&cancelAnimationFrame(e.requestId),null!=e.cb&&(e.cb(),e.cb=null)}),i=[]},t.queue=function(){return i},t.dequeue=function(e){for(var t=i.length-1;t>=0;)if(i[t]===e){i.splice(t,1);break}},t.fadeIn=function(r,u,a){if("function"==typeof u&&(a=u,u={}),u=u||{},n||0==u.duration)return r.style.opacity=1,void(a&&a());u.duration=e(u.duration),o={fadeIn:!0,el:r,cb:a},i.push(o);var s=window.getComputedStyle(r).getPropertyValue("opacity");r.style.opacity=+s;var c=+new Date,l=function(){var e=(new Date-c)/u.duration,n=+r.style.opacity+e;r.style.opacity=n,c=+new Date,+r.style.opacity<1?window.requestAnimationFrame?o.requestId=requestAnimationFrame(l):o.timeoutId=setTimeout(l,16):(t.dequeue(o),o.cb&&a())};l()},t.fadeOut=function(r,u,a){if("function"==typeof u&&(a=u,u={}),u=u||{},n||0==u.duration)return r.style.opacity=0,void(a&&a());u.duration=e(u.duration),o={fadeIn:!1,el:r,cb:a},i.push(o);var s=window.getComputedStyle(r).getPropertyValue("opacity");r.style.opacity=+s;var c=+new Date,l=function(){var e=(new Date-c)/u.duration,n=+r.style.opacity-e;r.style.opacity=n,c=+new Date,+r.style.opacity>0?window.requestAnimationFrame?o.requestId=requestAnimationFrame(l):o.timeoutId=setTimeout(l,16):(t.dequeue(o),o.cb&&a())};l()},t}var t=t();return t}),define("transition/fade",["require","../utils/jqr/fade"],function(e){function t(){var e={};return e.intro=function(e,t){var n=e.target;if(null==n)throw new Error("options.target is not defined!");var i=e.duration||"fast";e.firstView&&(i=0);var o=document.querySelector(e.target);r.fadeIn(o,{duration:i},function(){t()})},e.outro=function(e,t){var n=e.target;if(null==n)throw new Error("options.target is not defined!");var i=e.duration||"fast";e.firstView&&(i=0);var o=document.querySelector(e.target);r.fadeOut(o,{duration:i},function(){t()})},e}var r=e("../utils/jqr/fade");return t()}),define("transition/intro",["require","../utils/jqr/npo","./fade"],function(e){function t(e){var t=new Promise(function(n,i){if(e.fx!==!0)return n(),t;var o=e.intro||r.intro;o(e,n)});return t}e("../utils/jqr/npo");var r=e("./fade");return t}),define("transition/outro",["require","../utils/jqr/npo","./fade"],function(e){function t(e){var t=new Promise(function(n,i){if(e.fx!==!0)return n(),t;var o=e.outro||r.outro;o(e,n)});return t}e("../utils/jqr/npo");var r=e("./fade");return t}),define("utils/severity",["require"],function(e){function t(){this.DEBUG=0,this.INFO=1,this.WARNING=2,this.ERROR=3}return new t}),define("ractivelib/render/create",["require","../../utils/jqr/npo","../../utils/utils","../../utils/jqr/jqutils","../../utils/severity"],function(e){function t(e){var t=new Promise(function(o,u){if(null==e.viewOrPromise)return console.warn("Ignoring view since onInit returned null. onInit must return either a Ractive function or a promise that resolves to a Ractive function."),u({level:i.INFO,message:"Ignoring view since onInit returned null. onInit must return either a Ractive function or a promise that resolves to a Ractive function."}),t;if(r.isPromise(e.viewOrPromise))e.viewOrPromise.then(function(r){if("function"==typeof r&&(r=new r),!e.mvc.requestTracker.active)return u("Request overwritten by another view request"),t;var n=r;o(n)})["catch"](function(){e.mvc.requestTracker.active||0!==arguments.length?u.apply(void 0,arguments):u("Request overwritten by another view request")});else if(n.isFunction(e.viewOrPromise)){var a=new e.viewOrPromise;o(a)}else if(r.isRactiveObject(e.viewOrPromise)){var a=e.viewOrPromise;o(a)}else console.warn("Ignoring view since onInit did not return a valid response. onInit must return either a Ractive function or a promise that resolves to a Ractive function."),u("Ignoring view since onInit did not return a valid response. onInit must return either a Ractive function or a promise that resolves to a Ractive function.")});return t}e("../../utils/jqr/npo");var r=e("../../utils/utils"),n=e("../../utils/jqr/jqutils"),i=e("../../utils/severity");return t}),define("ractivelib/render/render",["require","../../utils/jqr/npo"],function(e){function t(e){var t=new Promise(function(t,r){e.view.transitionsEnabled=!1,e.view.render(e.target).then(function(){e.view.transitionsEnabled=!0,t(e.view)})["catch"](function(t){r.apply(void 0,[t,e.view])})});return t}return e("../../utils/jqr/npo"),t}),define("ractivelib/render/unrender",["require","../../utils/jqr/npo"],function(e){function t(e){var t=new Promise(function(t,r){e.mvc.view.transitionsEnabled=!1,e.mvc.view.unrender().then(function(){t(e.view)})["catch"](function(t){r.apply(void 0,[t,e.view])})});return t}return e("../../utils/jqr/npo"),t}),define("ractivelib/RactiveViewFactory",["require","./render/create","./render/render","./render/unrender"],function(e){function t(){var e={};return e.createView=function(e){return r(e)},e.renderView=function(e){return n(e)},e.unrenderView=function(e){return i(e)},e}var r=e("./render/create"),n=e("./render/render"),i=e("./render/unrender");return new t}),function(){"use strict";function e(){}function t(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var n=e.prototype,i=this,o=i.EventEmitter;n.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp){t={};for(r in n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r])}else t=n[e]||(n[e]=[]);return t},n.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},n.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&(t={},t[e]=r),t||r},n.addListener=function(e,r){var n,i=this.getListenersAsObject(e),o="object"==typeof r;for(n in i)i.hasOwnProperty(n)&&-1===t(i[n],r)&&i[n].push(o?r:{listener:r,once:!1});return this},n.on=r("addListener"),n.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},n.once=r("addOnceListener"),n.defineEvent=function(e){return this.getListeners(e),this},n.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},n.removeListener=function(e,r){if(null==r)return this.removeEvent(e);var n,i,o=this.getListenersAsObject(e);for(i in o)o.hasOwnProperty(i)&&(n=t(o[i],r),-1!==n&&o[i].splice(n,1));return this},n.off=r("removeListener"),n.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},n.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},n.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,u=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):u.call(this,n,i));return this},n.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},n.removeAllListeners=r("removeEvent"),n.emitEvent=function(e,t){var r,n,i,o,u,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(r=a[o].slice(0),i=r.length;i--;)n=r[i],n.once===!0&&this.removeListener(e,n.listener),u=n.listener.apply(this,t||[]),u===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},n.trigger=r("emitEvent"),n.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},n.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},n._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},n._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=o,e},"function"==typeof define&&define.amd?define("utils/jqr/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:i.EventEmitter=e}.call(this),define("kudu",["require","./router/router","./utils/jqr/npo","ractive","./utils/ajaxTracker","./utils/simpleAjaxTracker","./lifecycle/onInitHandler","./lifecycle/onRemoveHandler","./ractivelib/setupEvents","./ractivelib/setupDefaultEvents","./transition/intro","./transition/outro","./ractivelib/RactiveViewFactory","./utils/severity","./utils/utils","./utils/jqr/jqutils","./utils/jqr/EventEmitter","./utils/jqr/fade"],function(e){function t(){function e(e){var t=new Promise(function(t,r){var n={route:e.route,ctrl:e.ctrl,routeParams:e.routeParams,args:e.args,mvc:e.mvc,ajaxTracker:e.ajaxTracker,target:e.target,prev:{ajaxTracker:e.mvc.options.ajaxTracker,ctrl:e.mvc.ctrl,route:e.mvc.route,routeParams:e.mvc.options.routeParams,view:e.mvc.view,args:e.mvc.options.args}};j.triggerEvent("beforeInit",e),u(n).then(function(n){e.viewOrPromise=n,j.createView(e).then(function(n){e.view=n,e.kudu=j,j.triggerEvent("init",e),j.processNewView(e).then(function(e){g(),t()})["catch"](function(){g(),r.apply(void 0,arguments)})})["catch"](function(){g(),r.apply(void 0,arguments)})})["catch"](function(){g(),r.apply(void 0,arguments)})});return t}function t(e){var t=new Promise(function(t,r){var n={next:{ctrl:e.ctrl,route:e.route,view:e.view,args:e.args,routeParams:e.routeParams,ajaxTracker:e.ajaxTracker},ctrl:R.ctrl,route:R.route,view:R.view,routeParams:R.options.routeParams,args:R.options.args,mvc:e.mvc,ajaxTracker:R.options.ajaxTracker,target:R.options.target};a(n).then(function(){j.triggerEvent("remove",e),j.triggerEvent("beforeUnrender",e),t()})["catch"](function(){null!=R.view&&(R.view.transitionsEnabled=!0),r.apply(void 0,arguments)})});return t}function g(){E.splice(0,1),0===E.length&&(b.enable=!1,b={enable:!0},y(b))}function y(e){setTimeout(function(){e.enable&&w.off(!1)},350)}function P(e,t){var r=t;if(Array.isArray(t)||(r=Array.prototype.slice.call(t)),e.error=r,j.triggerEvent("viewFail",e),O.debug)if(0===e.error.length)console.error("error occurred!",e);else for(var n=0;n<e.error.length;n++)null==e.error[n].stack?console.error(e.error[n]):console.error(e.error[n].stack)}function q(e){e.mvc.requestTracker.active!==!1&&(e.mvc.requestTracker.active=!1,I.abort(e.target),I.clear(e.target))}function x(e,t){e.id||Object.defineProperty(e,"id",{enumerable:!1,writable:!1,value:t})}var j=new m,b={enable:!0},R={view:null,ctrl:null,requestTracker:{active:!0},route:null,options:{routeParams:null,args:null}},E=[],O={target:null,routes:null,defaultRoute:null,unknownRouteResolver:null,intro:null,outro:null,fx:!1,viewFactory:v,debug:!0},I=i(j);return j.init=function(e){if(null==e)throw new Error("kudu.init() requires options!");O=p.extend({},O,e),j.validateInitOptions(O),n.DEBUG=O.debug,r.on("routeload",function(e){null==j.getActiveRoute()?e.initialRoute=!0:e.initialRoute=!1,j.routeLoaded(e)}),c(e),r.init({routes:O.routes,defaultRoute:e.defaultRoute,unknownRouteResolver:e.unknownRouteResolver})},j.router=function(){return r},j.validateInitOptions=function(e){if(null==e.viewFactory)throw new Error("viewFactory cannot be null!");if(null==e.viewFactory.createView)throw new Error("viewFactory must provide a createView function!");if(null==e.viewFactory.renderView)throw new Error("viewFactory must provide a renderView function!");if(null==e.viewFactory.unrenderView)throw new Error("viewFactory must provide an unrenderView function!")},j.go=function(e){r.go(e)},j.getDefaultTarget=function(){
return O.target},j.getActiveRoute=function(){return R.route},j.routeLoaded=function(r){try{E.push(1),r.target=r.target||O.target,r.routeParams=r.routeParams||{},r.args=r.args||{},r.ajaxTracker=o.create(I,r),r.mvc=p.extend({},R),q(r);var n={active:!0};R.requestTracker=n,r.mvc.requestTracker=n,E.length>1&&(w.off(!0),w.stop(),b.enable=!1);var i=j.createController(r.module);r.ctrl=i,delete r.module,null==R.ctrl?e(r).then(function(){})["catch"](function(){q(r);var e=arguments[0];null!=e&&e.level<d.ERROR||P(r,arguments)}):t(r).then(function(){e(r).then(function(){})["catch"](function(){q(r);var e=arguments[0];null!=e&&e.level<d.ERROR||P(r,arguments)})})["catch"](function(){q(r),P(r,arguments)})}catch(u){P(r,[u])}},j.createController=function(e){if(e instanceof Function){var t=new e;return null==t.id&&x(t,e.id),t}return e},j.processNewView=function(e){var t=new Promise(function(t,r){s(e);var n;n=null!=e.route.enter||null!=R.route&&null!=R.route.leave?j.customRenderView:j.renderViewWithAnimation,n(e).then(function(){j.callViewEvent("onComplete",e),j.triggerEvent("complete",e),t(e.view)})["catch"](function(e,t){r(e,t)}),e.mvc.requestTracker.active||r.apply(void 0,["Request overwritten by another view request in [ProcessNewView]",e.mvc.view])});return t},j.callViewEvent=function(e,t){var r=t.ctrl;if("function"==typeof r[e]){var n={ajaxTracker:t.ajaxTracker,routeParams:t.routeParams,args:t.args,view:t.view,ctrl:t.ctrl,route:t.route},i={ajaxTracker:t.mvc.options.ajaxTracker,ctrl:t.mvc.ctrl,route:t.mvc.route,routeParams:t.mvc.options.routeParams,args:t.mvc.options.args,view:t.mvc.view},o={};"onUnrender"===e?(o=i,o.next=n):(o=n,o.prev=i),r[e](o)}},j.triggerEvent=function(e,t){t=t||{},t.mvc=t.mvc||{};var r=(O.target===t.target,t.ctrl);null==r&&(r={});var n={ajaxTracker:t.ajaxTracker,routeParams:t.routeParams,args:t.args,view:t.view,ctrl:t.ctrl,route:t.route},i={ajaxTracker:t.mvc.options.ajaxTracker,ctrl:t.mvc.ctrl,route:t.mvc.route,routeParams:t.mvc.options.routeParams,args:t.mvc.options.args,view:t.mvc.view},o={};"remove"===e||"beforeUnrender"===e||"unrender"===e?(o=i,o.next=n):"fail"===e?(o=i,o.prev=i,o.next=n):(o=n,o.prev=i);var u="lc.";j.emit(u+e,o),t[e]&&t[e](o)},j.enter=function(e){var t=new Promise(function(t,r){var n={duration:"fast",target:e.target,intro:O.intro,fx:O.fx||!1};null==R.ctrl&&(n.firstView=!0),j.renderView(e).then(function(){l(n).then(function(){t(e.view)})["catch"](function(e,t){r.apply(void 0,[e,t])})})["catch"](function(e,t){r.apply(void 0,[e,t])})});return t},j.leave=function(e){var t=new Promise(function(t,r){var n={duration:100,target:e.target,outro:O.outro,fx:O.fx||!1};null==R.ctrl&&(n.firstView=!0,n.duration=0),f(n).then(function(){return e.mvc.requestTracker.active?void j.unrenderView(e).then(function(){t(e.view)})["catch"](function(e,t){r.apply(void 0,[e,t])}):void r.apply(void 0,["Request overwritten by another view request in [outro]",e.mvc.view])})["catch"](function(t){r.apply(void 0,[t,e.mvc.view])})});return t},j.renderViewWithAnimation=function(e){var t=new Promise(function(t,r){j.leave(e).then(function(){j.enter(e).then(function(){t(e.view)})["catch"](function(e,t){r.apply(void 0,[e,t])})})["catch"](function(e,t){r.apply(void 0,[e,t])})});return t},j.customLeave=function(e){var t=new Promise(function(t,r){var n,i,o={ctrl:R.ctrl,view:R.view,route:R.route,next:{ctrl:e.ctrl,view:e.view,route:e.route},target:e.target};null==e.mvc.view?(n=function(){},i=h.noopPromise):(null!=R.route&&(n=R.route.leave,i=j.unrenderViewCleanup),null==n&&(n=j.leave,i=h.noopPromise,o=e));var u=n(o);null==u&&(u=h.noopPromise()),u.then(function(){i(e).then(function(){return e.mvc.requestTracker.active?void t():void r.apply(void 0,["Request overwritten by another view request [leaveCleanUp]",e.mvc.view])})["catch"](function(t){r.apply(void 0,[t,e.view])})})["catch"](function(){r("Error during route.leave()")})});return t},j.customEnter=function(e){var t=new Promise(function(t,r){var n={ctrl:e.ctrl,view:e.view,route:e.route,prev:{ctrl:R.ctrl,view:R.view,route:R.route},target:e.target},i=e.route.enter,o=j.renderViewCleanup;null==i&&(i=j.enter,o=h.noopPromise,n=e);var u=i(n);null==u&&(u=h.noopPromise()),u.then(function(){o(e).then(function(){t(e.view)})["catch"](function(t){r.apply(void 0,[t,e.view])})})["catch"](function(){r("Error during route.enter()")})});return t},j.customRenderView=function(e){var t=new Promise(function(t,r){j.customLeave(e).then(function(){j.customEnter(e).then(function(){t(e.view)})["catch"](function(e,t){r.apply(void 0,[e,t])})})["catch"](function(e,t){r.apply(void 0,[e,t])})});return t},j.createView=function(e){var t=O.viewFactory.createView(e);return t},j.renderView=function(e){var t=new Promise(function(t,r){var n=O.viewFactory.renderView(e);n.then(function(){j.renderViewCleanup(e).then(function(){t(e.view)})["catch"](function(t){r.apply(void 0,[t,e.view])})})["catch"](function(t){r.apply(void 0,[t,e.view])})});return t},j.renderViewCleanup=function(e){var t=new Promise(function(r,n){j.updateMVC(e);try{j.callViewEvent("onRender",e),j.triggerEvent("render",e)}catch(i){return n(i),t}r()});return t},j.unrenderView=function(e){var t=new Promise(function(t,r){if(null==e.mvc.view)t();else{var n=O.viewFactory.unrenderView(e);n.then(function(){j.unrenderViewCleanup(e).then(function(){return e.mvc.requestTracker.active?void t(e.mvc.view):void r.apply(void 0,["Request overwritten by another view request in [unrenderView]",e.mvc.view])})["catch"](function(t){r.apply(void 0,[t,e.view])})})["catch"](function(){r(e.mvc.view)})}});return t},j.unrenderViewCleanup=function(e){var t=new Promise(function(r,n){try{j.callViewEvent("onUnrender",e),j.triggerEvent("unrender",e)}catch(i){return n(i),t}r()});return t},j.updateMVC=function(e){R.view=e.view,R.ctrl=e.ctrl,R.options=e,R.route=e.route},j}var r=e("./router/router");e("./utils/jqr/npo");var n=e("ractive"),i=e("./utils/ajaxTracker"),o=e("./utils/simpleAjaxTracker"),u=e("./lifecycle/onInitHandler"),a=e("./lifecycle/onRemoveHandler"),s=e("./ractivelib/setupEvents"),c=e("./ractivelib/setupDefaultEvents"),l=e("./transition/intro"),f=e("./transition/outro"),v=e("./ractivelib/RactiveViewFactory"),d=e("./utils/severity"),h=e("./utils/utils"),p=e("./utils/jqr/jqutils"),m=e("./utils/jqr/EventEmitter"),w=e("./utils/jqr/fade"),g=t();return g});
//# sourceMappingURL=kudu.min.js.map